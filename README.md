# Telegram-bot for English

Телеграм-бот для изучения английских слов по методу интерваьлных повторений.  

### Стек

- Go
- PostgreSQL
- `gopkg.in/telebot.v4`
- `golang-migrate` (миграции)

### Переменные окружения

Используется `.env` - подхватывается автоматически.

#### Required

- `TOKEN` — токен Telegram-бота
- `DB_DSN` — строка подключения к PostgreSQL

#### Optional

- `POLLING_TIMEOUT` — timeout long polling, по умолчанию `10s`
- `DEBUG` — `true/false`, по умолчанию `false`
- `LOG_FORMAT` — `console` или `json`, по умолчанию `console`
- `TIME_FORMAT` — формат времени в console-логах, по умолчанию `2006-01-02 15:04:05`

### Сборка и запуск

#### 1) Миграции

```bash
./bin/migrator --up
```

#### 2) Сиды

```bash
./bin/seeder --up
```

Опционально с указанием файла:

```bash
./bin/seeder --up --file ./seeds/random_pool_a2_basic_50.json
```

#### 3) Сам бот

```bash
go build -o ./bin/bot ./cmd/bot && ./bin/bot
```

Или без сборки:

```bash
go run ./cmd/bot/main.go
```

### Юзкейсы

- Onboarding:
  - `/start` — регистрация пользователя (идемпотентно), приветствие
  - `/removeMe` — удаление пользователя и связанных данных

- Catalog:
  - `/dict` — список публичных словарей
  - `/mydict` — список словарей пользователя
  - `Подробнее` — карточка словаря + примеры слов

- Subscription:
  - `Подписаться` / `Отписаться`
  - при отписке показывается подтверждение `Да/Нет`
  - при подтверждении отписки удаляется прогресс словаря

- Learning:
  - вход: `/learn <номер>` или кнопка `Учить` у словаря
  - показывается случайное новое слово (которое еще не трекалось у пользователя)
  - действия:
    - `Добавить в словарь` (проставляется `status=learning`)
    - `Не показывать` (проставляется `status=blocked` и больше не показывается пользователю)
    - `Повторить` (WIP)
    - `Назад` (возврат в меню)

- Review:
  - WIP

### Примечания

- seeder выполняет операции идемпотентно.
- migrator выполняет операции идемпотентно.
- Из 2-х типов словарей сейчас поддерживаются только `random_pool`-словари.
- Названия словарей должны быть уникальными (среди всех авторов) - это констрейнт данной системы.
